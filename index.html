<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>íŒŒí¬ê³¨í”„ ë²Œê¸ˆ íŠ¸ë˜ì»¤</title>
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#10b981">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Malgun Gothic', sans-serif;
            background: linear-gradient(135deg, #ecfdf5 0%, #d1fae5 100%);
            min-height: 100vh;
            padding: 1rem;
        }

        .container {
            max-width: 600px;
            margin: 0 auto;
            padding-top: 2rem;
        }

        .card {
            background: white;
            border-radius: 1rem;
            padding: 1.5rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            margin-bottom: 1rem;
        }

        .title {
            font-size: 2rem;
            font-weight: bold;
            color: #047857;
            text-align: center;
            margin-bottom: 0.5rem;
        }

        .subtitle {
            text-align: center;
            color: #059669;
            margin-bottom: 2rem;
        }

        .btn {
            width: 100%;
            padding: 1rem;
            border: none;
            border-radius: 0.5rem;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            margin-bottom: 0.75rem;
            transition: all 0.2s;
        }

        .btn-primary {
            background: #10b981;
            color: white;
        }

        .btn-primary:hover {
            background: #059669;
        }

        .btn-primary:active {
            background: #047857;
            transform: scale(0.98);
        }

        .btn-secondary {
            background: #e5e7eb;
            color: #374151;
        }

        .btn-secondary:hover {
            background: #d1d5db;
        }

        .btn-danger {
            background: #ef4444;
            color: white;
            padding: 0.5rem 1rem;
            font-size: 0.9rem;
        }

        .btn-small {
            padding: 0.5rem 1rem;
            font-size: 0.9rem;
            width: auto;
        }

        .input-field {
            width: 100%;
            padding: 0.75rem;
            border: 2px solid #d1d5db;
            border-radius: 0.5rem;
            font-size: 1rem;
            margin-bottom: 1rem;
        }

        .input-field:focus {
            outline: none;
            border-color: #10b981;
        }

        .player-item {
            padding: 1rem;
            border-radius: 0.5rem;
            border: 2px solid #e5e7eb;
            margin-bottom: 0.75rem;
            display: flex;
            align-items: center;
            gap: 0.75rem;
            transition: all 0.2s;
        }

        .player-item.active {
            border-color: #10b981;
            background: #ecfdf5;
        }

        .player-item input[type="checkbox"] {
            width: 1.25rem;
            height: 1.25rem;
            cursor: pointer;
        }

        .player-name {
            flex: 1;
            font-weight: 500;
        }

        .course-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 0.5rem;
            margin-bottom: 1rem;
        }

        .course-btn {
            padding: 1rem;
            border: 2px solid #e5e7eb;
            border-radius: 0.5rem;
            background: white;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }

        .course-btn.selected {
            background: #10b981;
            color: white;
            border-color: #10b981;
        }

        .course-btn.has-data {
            background: linear-gradient(135deg, white 0%, #dbeafe 100%);
            border-color: #3b82f6;
        }

        .course-btn.has-data.selected {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
            border-color: #10b981;
        }

        .player-btn {
            padding: 1.5rem;
            border-radius: 0.75rem;
            border: 2px solid #e5e7eb;
            background: white;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            min-height: 80px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .player-btn.winner {
            background: #fbbf24;
            color: #78350f;
            border-color: #fbbf24;
            transform: scale(1.05);
            box-shadow: 0 4px 12px rgba(251, 191, 36, 0.4);
        }

        .player-btn.draw {
            background: #60a5fa;
            color: #1e3a8a;
            border-color: #60a5fa;
            transform: scale(1.05);
            box-shadow: 0 4px 12px rgba(96, 165, 250, 0.4);
        }

        .player-btn.allfail {
            background: #f87171;
            color: #7f1d1d;
            border-color: #f87171;
            transform: scale(1.05);
            box-shadow: 0 4px 12px rgba(248, 113, 113, 0.4);
        }

        .hole-indicator {
            display: grid;
            grid-template-columns: repeat(9, 1fr);
            gap: 0.25rem;
            margin-top: 1rem;
        }

        .hole-dot {
            aspect-ratio: 1;
            border-radius: 0.25rem;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.75rem;
            font-weight: 600;
        }

        .hole-dot.current {
            background: #10b981;
            color: white;
        }

        .hole-dot.completed {
            background: #d1fae5;
            color: #047857;
        }

        .hole-dot.pending {
            background: #e5e7eb;
            color: #9ca3af;
        }

        .stats-card {
            padding: 1rem;
            background: linear-gradient(135deg, #ffffff 0%, #ecfdf5 100%);
            border: 2px solid #10b981;
            border-radius: 0.75rem;
            margin-bottom: 1rem;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 0.5rem;
            margin-top: 0.75rem;
        }

        .stat-item {
            text-align: center;
            padding: 0.75rem;
            border-radius: 0.5rem;
        }

        .stat-label {
            font-size: 0.875rem;
            font-weight: 600;
            margin-bottom: 0.25rem;
        }

        .stat-value {
            font-size: 1.25rem;
            font-weight: bold;
        }

        .record-card {
            border: 2px solid #e5e7eb;
            border-radius: 0.75rem;
            overflow: hidden;
            margin-bottom: 1rem;
        }

        .record-header {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
            padding: 1rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .record-body {
            padding: 1rem;
            background: white;
        }

        .record-player {
            padding: 0.75rem;
            background: #f9fafb;
            border: 1px solid #e5e7eb;
            border-radius: 0.5rem;
            margin-bottom: 0.5rem;
        }

        .hidden {
            display: none;
        }

        .info-box {
            padding: 1rem;
            background: #dbeafe;
            border-radius: 0.5rem;
            margin-top: 1rem;
            font-size: 0.875rem;
            color: #1e40af;
        }

        .header-buttons {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 1rem;
        }
    </style>
</head>
<body>
    <div class="container" id="app">
        <!-- ë©”ì¸ ë©”ë‰´ -->
        <div id="mainMenu">
            <h1 class="title">â›³ ë…ìˆ˜ë¦¬ íŒŒí¬ê³¨í”„</h1>
            <p class="subtitle">2025 All right Reserved ì˜¤ì¬í›ˆ</p>
            <div class="card">
                <button class="btn btn-primary" onclick="showPage('players')">ğŸ‘¥ í”Œë ˆì´ì–´ ê´€ë¦¬</button>
                <button class="btn btn-primary" onclick="showPage('game')">ğŸ® ê²Œì„ ì‹œì‘</button>
                <button class="btn btn-primary" onclick="showPage('records')">ğŸ“Š ê²Œì„ ê¸°ë¡</button>
                <button class="btn btn-secondary" onclick="exitApp()">âŒ ì¢…ë£Œ</button>
            </div>
            <div style="text-align: center; margin-top: 2rem; color: #6b7280; font-size: 0.875rem;">
                v1.0.0
            </div>
        </div>

        <!-- í”Œë ˆì´ì–´ ê´€ë¦¬ -->
        <div id="playersPage" class="hidden">
            <div class="header-buttons">
                <button class="btn btn-secondary btn-small" onclick="showPage('main')">â† ëŒì•„ê°€ê¸°</button>
            </div>
            <div class="card">
                <h2 style="font-size: 1.5rem; font-weight: bold; color: #047857; margin-bottom: 1.5rem;">
                    ğŸ‘¥ í”Œë ˆì´ì–´ ê´€ë¦¬
                </h2>
                <div id="playersList"></div>
                <div class="info-box">
                    ğŸ’¡ ì²´í¬ë°•ìŠ¤ë¥¼ ì„ íƒí•˜ì—¬ ê²Œì„ì— ì°¸ê°€í•  í”Œë ˆì´ì–´ë¥¼ ì§€ì •í•˜ì„¸ìš”. ìµœëŒ€ 6ëª…ê¹Œì§€ ì°¸ê°€ ê°€ëŠ¥í•©ë‹ˆë‹¤.
                </div>
            </div>
        </div>

        <!-- ê²Œì„ ì„¤ì • -->
        <div id="gameSetup" class="hidden">
            <div class="header-buttons">
                <button class="btn btn-secondary btn-small" onclick="showPage('main')">â† ëŒì•„ê°€ê¸°</button>
            </div>
            <div class="card">
                <h2 style="font-size: 1.5rem; font-weight: bold; color: #047857; margin-bottom: 1.5rem;">
                    ğŸ® ê²Œì„ ì„¤ì •
                </h2>
                <label style="display: block; font-weight: 600; margin-bottom: 0.5rem;">ë²Œê¸ˆ ê¸ˆì•¡</label>
                <input type="number" id="penaltyInput" class="input-field" value="500" step="100">
                
                <label style="display: block; font-weight: 600; margin-bottom: 0.5rem;">ì½”ìŠ¤ ì„ íƒ</label>
                <div class="course-grid" id="courseGrid"></div>
                
                <label style="display: block; font-weight: 600; margin-bottom: 0.5rem;">ì°¸ê°€ í”Œë ˆì´ì–´</label>
                <div id="activePlayersList"></div>
                
                <button class="btn btn-primary" onclick="startGame()" style="margin-top: 1rem;">ê²Œì„ ì‹œì‘</button>
            </div>
        </div>

        <!-- ê²Œì„ ì§„í–‰ -->
        <div id="gamePlaying" class="hidden">
            <div class="header-buttons">
                <button class="btn btn-secondary btn-small" onclick="showPage('game')">â† ì„¤ì •ìœ¼ë¡œ</button>
                <button class="btn btn-secondary btn-small" onclick="showCurrentResult()">ğŸ“Š ê²°ê³¼ ë³´ê¸°</button>
            </div>
            <div class="card">
                <h2 id="holeTitle" style="font-size: 1.75rem; font-weight: bold; color: #047857; text-align: center; margin-bottom: 0.5rem;"></h2>
                <p style="text-align: center; color: #6b7280; margin-bottom: 1.5rem;">1ë“± í”Œë ˆì´ì–´ë¥¼ ì„ íƒí•˜ì„¸ìš”</p>
                
                <div id="playersGrid" style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 0.75rem; margin-bottom: 1.5rem;"></div>
                
                <div style="display: flex; gap: 0.5rem; margin-bottom: 1rem;">
                    <button class="btn btn-secondary" onclick="prevHole()" id="prevBtn" style="flex: 1;">â† ì´ì „ í™€</button>
                    <button class="btn btn-primary" onclick="nextHole()" id="nextBtn" style="flex: 1;">ë‹¤ìŒ í™€ â†’</button>
                </div>
                
                <div class="hole-indicator" id="holeIndicator"></div>
            </div>
        </div>

        <!-- ê²Œì„ ê²°ê³¼ -->
        <div id="gameResult" class="hidden">
            <div class="header-buttons">
                <button class="btn btn-secondary btn-small" onclick="backToGame()">â† ê²Œì„ìœ¼ë¡œ</button>
            </div>
            <div class="card">
                <h2 style="font-size: 1.5rem; font-weight: bold; color: #047857; text-align: center; margin-bottom: 1.5rem;">
                    ğŸ† ê²Œì„ ê²°ê³¼
                </h2>
                <div id="resultStats"></div>
                <div style="display: flex; gap: 0.5rem; margin-top: 1rem;">
                    <button class="btn btn-primary" onclick="showPage('main')" style="flex: 1;">ë©”ì¸ìœ¼ë¡œ</button>
                    <button class="btn btn-secondary" onclick="newGame()" style="flex: 1;">ë‹¤ìŒ ê²Œì„</button>
                </div>
            </div>
        </div>

        <!-- ê²Œì„ ê¸°ë¡ -->
        <div id="recordsPage" class="hidden">
            <div class="header-buttons">
                <button class="btn btn-secondary btn-small" onclick="showPage('main')">â† ëŒì•„ê°€ê¸°</button>
            </div>
            <div class="card">
                <h2 style="font-size: 1.5rem; font-weight: bold; color: #047857; margin-bottom: 1.5rem;">
                    ğŸ“Š ê²Œì„ ê¸°ë¡
                </h2>
                
                <div style="display: flex; gap: 0.5rem; margin-bottom: 1rem;">
                    <button class="btn btn-secondary btn-small" onclick="exportData()" style="flex: 1;">
                        ğŸ“¥ ë°ì´í„° ë‚´ë³´ë‚´ê¸°
                    </button>
                    <button class="btn btn-secondary btn-small" onclick="importData()" style="flex: 1;">
                        ğŸ“¤ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
                    </button>
                </div>
                
                <div id="recordsList"></div>
            </div>
        </div>
    </div>

    <script>
        // ë°ì´í„° ì €ì¥ì†Œ
        const STORAGE_KEYS = {
            PLAYERS: 'parkgolf_players',
            GAMES: 'parkgolf_games',
            PENALTY: 'parkgolf_penalty'
        };

        // ì•± ìƒíƒœ
        let players = [];
        let currentCourse = 1;
        let currentHole = 1;
        let winners = {};
        let penalty = 500;

        // ì´ˆê¸°í™”
        function init() {
            loadPlayers();
            loadPenalty();
            showPage('main');
        }

        // í”Œë ˆì´ì–´ ë¡œë“œ
        function loadPlayers() {
            const saved = localStorage.getItem(STORAGE_KEYS.PLAYERS);
            if (saved) {
                players = JSON.parse(saved);
            } else {
                players = Array.from({ length: 6 }, (_, i) => ({
                    id: `player-${i + 1}`,
                    name: `í”Œë ˆì´ì–´${i + 1}`,
                    isActive: false
                }));
                savePlayers();
            }
        }

        // í”Œë ˆì´ì–´ ì €ì¥
        function savePlayers() {
            localStorage.setItem(STORAGE_KEYS.PLAYERS, JSON.stringify(players));
        }

        // ë²Œê¸ˆ ë¡œë“œ
        function loadPenalty() {
            const saved = localStorage.getItem(STORAGE_KEYS.PENALTY);
            penalty = saved ? parseInt(saved) : 500;
        }

        // ë²Œê¸ˆ ì €ì¥
        function savePenalty() {
            localStorage.setItem(STORAGE_KEYS.PENALTY, penalty.toString());
        }

        // í˜ì´ì§€ ì „í™˜
        function showPage(page) {
            document.querySelectorAll('#app > div').forEach(div => div.classList.add('hidden'));
            
            switch(page) {
                case 'main':
                    document.getElementById('mainMenu').classList.remove('hidden');
                    break;
                case 'players':
                    document.getElementById('playersPage').classList.remove('hidden');
                    renderPlayersList();
                    break;
                case 'game':
                    document.getElementById('gameSetup').classList.remove('hidden');
                    renderGameSetup();
                    break;
                case 'records':
                    document.getElementById('recordsPage').classList.remove('hidden');
                    renderRecords();
                    break;
            }
        }

        // í”Œë ˆì´ì–´ ëª©ë¡ ë Œë”ë§
        function renderPlayersList() {
            const list = document.getElementById('playersList');
            list.innerHTML = players.map(player => `
                <div class="player-item ${player.isActive ? 'active' : ''}">
                    <input type="checkbox" ${player.isActive ? 'checked' : ''} 
                           onchange="togglePlayer('${player.id}')">
                    <input type="text" class="player-name" value="${player.name}" 
                           onchange="updatePlayerName('${player.id}', this.value)"
                           onblur="updatePlayerName('${player.id}', this.value)"
                           placeholder="ì´ë¦„ ì…ë ¥"
                           style="border: none; background: transparent; font-size: 1rem;">
                </div>
            `).join('');
        }

        // í”Œë ˆì´ì–´ í™œì„±í™” í† ê¸€
        function togglePlayer(id) {
            const player = players.find(p => p.id === id);
            if (player) {
                player.isActive = !player.isActive;
                savePlayers();
                renderPlayersList();
            }
        }

        // í”Œë ˆì´ì–´ ì´ë¦„ ìˆ˜ì •
        function updatePlayerName(id, name) {
            const player = players.find(p => p.id === id);
            if (player) {
                const trimmedName = name.trim();
                if (trimmedName.length === 0) {
                    alert('í”Œë ˆì´ì–´ ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                    renderPlayersList();
                    return;
                }
                if (trimmedName.length > 10) {
                    alert('í”Œë ˆì´ì–´ ì´ë¦„ì€ 10ì ì´í•˜ë¡œ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                    renderPlayersList();
                    return;
                }
                player.name = trimmedName;
                savePlayers();
                renderPlayersList();
            }
        }

        // ê²Œì„ ì„¤ì • ë Œë”ë§
        function renderGameSetup() {
            document.getElementById('penaltyInput').value = penalty;
            
            // ì½”ìŠ¤ ë²„íŠ¼
            const courseGrid = document.getElementById('courseGrid');
            courseGrid.innerHTML = Array.from({ length: 9 }, (_, i) => i + 1)
                .map(course => {
                    const todayGame = getTodayGameByCourse(course);
                    const hasData = todayGame !== null;
                    
                    return `
                        <button class="course-btn ${course === currentCourse ? 'selected' : ''} ${hasData ? 'has-data' : ''}"
                                onclick="selectCourse(${course})">
                            ${course}ì½”ìŠ¤${hasData ? ' ğŸ“' : ''}
                        </button>
                    `;
                }).join('');
            
            // í™œì„± í”Œë ˆì´ì–´ ëª©ë¡
            const activePlayers = players.filter(p => p.isActive);
            const activeList = document.getElementById('activePlayersList');
            if (activePlayers.length === 0) {
                activeList.innerHTML = '<p style="color: #ef4444; margin: 1rem 0;">í”Œë ˆì´ì–´ ê´€ë¦¬ì—ì„œ ì°¸ê°€ìë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.</p>';
            } else {
                activeList.innerHTML = activePlayers.map(player => `
                    <div style="padding: 0.75rem; background: #ecfdf5; border: 1px solid #10b981; border-radius: 0.5rem; margin-bottom: 0.5rem;">
                        <span style="font-weight: 500; color: #047857;">${player.name}</span>
                    </div>
                `).join('');
            }
            
            // ì„ íƒëœ ì½”ìŠ¤ì— ë‹¹ì¼ ê²Œì„ì´ ìˆìœ¼ë©´ ì•Œë¦¼
            const todayGame = getTodayGameByCourse(currentCourse);
            if (todayGame) {
                activeList.innerHTML += `
                    <div style="padding: 1rem; background: #dbeafe; border: 2px solid #3b82f6; border-radius: 0.5rem; margin-top: 1rem;">
                        <div style="font-weight: 600; color: #1e40af; margin-bottom: 0.5rem;">
                            ğŸ“ ì˜¤ëŠ˜ ì´ ì½”ìŠ¤ì˜ ì €ì¥ëœ ê¸°ë¡ì´ ìˆìŠµë‹ˆë‹¤!
                        </div>
                        <button class="btn btn-secondary btn-small" onclick="loadTodayGame(${currentCourse})" style="width: 100%;">
                            ì´ì „ ê¸°ë¡ ë¶ˆëŸ¬ì˜¤ê¸°
                        </button>
                    </div>
                `;
            }
        }

        // ì½”ìŠ¤ ì„ íƒ
        function selectCourse(course) {
            currentCourse = course;
            renderGameSetup();
        }

        // ë‹¹ì¼ íŠ¹ì • ì½”ìŠ¤ì˜ ê²Œì„ ì°¾ê¸°
        function getTodayGameByCourse(course) {
            const games = JSON.parse(localStorage.getItem(STORAGE_KEYS.GAMES) || '[]');
            const today = new Date();
            const todayStr = `${today.getFullYear()}-${String(today.getMonth() + 1).padStart(2, '0')}-${String(today.getDate()).padStart(2, '0')}`;
            
            // ì˜¤ëŠ˜ ë‚ ì§œì˜ í•´ë‹¹ ì½”ìŠ¤ ê²Œì„ ì°¾ê¸° (ê°€ì¥ ìµœê·¼ ê²ƒ)
            const todayGames = games.filter(game => {
                const gameDate = new Date(game.date);
                const gameDateStr = `${gameDate.getFullYear()}-${String(gameDate.getMonth() + 1).padStart(2, '0')}-${String(gameDate.getDate()).padStart(2, '0')}`;
                return gameDateStr === todayStr && game.course === course;
            });
            
            return todayGames.length > 0 ? todayGames[todayGames.length - 1] : null;
        }

        // ë‹¹ì¼ ê²Œì„ ë¶ˆëŸ¬ì˜¤ê¸°
        function loadTodayGame(course) {
            const game = getTodayGameByCourse(course);
            if (!game) {
                alert('ë¶ˆëŸ¬ì˜¬ ê²Œì„ì´ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }
            
            if (!confirm('ì´ì „ì— ì €ì¥ëœ ê²Œì„ ê¸°ë¡ì„ ë¶ˆëŸ¬ì˜¤ì‹œê² ìŠµë‹ˆê¹Œ?\n(í˜„ì¬ ì…ë ¥ ì¤‘ì¸ ë‚´ìš©ì€ ì‚¬ë¼ì§‘ë‹ˆë‹¤)')) {
                return;
            }
            
            // ê²Œì„ ë°ì´í„° ë³µì›
            currentCourse = game.course;
            penalty = game.penalty;
            winners = { ...game.winners };
            currentHole = 1;
            
            // ì°¸ê°€ì ë³µì›
            players.forEach(p => {
                p.isActive = game.participants.some(participant => participant.id === p.id);
            });
            savePlayers();
            
            alert('âœ… ì´ì „ ê²Œì„ ê¸°ë¡ì„ ë¶ˆëŸ¬ì™”ìŠµë‹ˆë‹¤!\nê²Œì„ì„ ê³„ì† ì§„í–‰í•˜ê±°ë‚˜ ìˆ˜ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.');
            
            // ê²Œì„ ì§„í–‰ í™”ë©´ìœ¼ë¡œ ì „í™˜
            document.getElementById('gameSetup').classList.add('hidden');
            document.getElementById('gamePlaying').classList.remove('hidden');
            renderGamePlaying();
        }

        // ê²Œì„ ì‹œì‘
        function startGame() {
            const activePlayers = players.filter(p => p.isActive);
            if (activePlayers.length === 0) {
                alert('ê²Œì„ì— ì°¸ê°€í•  í”Œë ˆì´ì–´ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.');
                return;
            }
            
            const penaltyValue = parseInt(document.getElementById('penaltyInput').value);
            if (isNaN(penaltyValue) || penaltyValue < 0) {
                alert('ì˜¬ë°”ë¥¸ ë²Œê¸ˆ ê¸ˆì•¡ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }
            if (penaltyValue > 100000) {
                alert('ë²Œê¸ˆ ê¸ˆì•¡ì€ 100,000ì› ì´í•˜ë¡œ ì„¤ì •í•´ì£¼ì„¸ìš”.');
                return;
            }
            
            penalty = penaltyValue;
            savePenalty();
            
            currentHole = 1;
            winners = {};
            
            document.getElementById('gameSetup').classList.add('hidden');
            document.getElementById('gamePlaying').classList.remove('hidden');
            renderGamePlaying();
        }

        // ê²Œì„ ì§„í–‰ ë Œë”ë§
        function renderGamePlaying() {
            const activePlayers = players.filter(p => p.isActive);
            
            document.getElementById('holeTitle').textContent = `${currentCourse}ì½”ìŠ¤ - ${currentHole}ë²ˆí™€`;
            
            const grid = document.getElementById('playersGrid');
            
            // í”Œë ˆì´ì–´ ë²„íŠ¼ë“¤
            let buttons = activePlayers.map(player => `
                <button class="player-btn ${winners[currentHole] === player.id ? 'winner' : ''}"
                        onclick="selectWinner('${player.id}')">
                    ${winners[currentHole] === player.id ? 'ğŸ† ' : ''}${player.name}
                </button>
            `);
            
            // ë¬´ìŠ¹ë¶€ ë²„íŠ¼
            buttons.push(`
                <button class="player-btn ${winners[currentHole] === 'draw' ? 'draw' : ''}"
                        onclick="selectWinner('draw')" 
                        style="grid-column: span 1;">
                    ${winners[currentHole] === 'draw' ? 'ğŸ¤ ' : ''}ë¬´ìŠ¹ë¶€
                </button>
            `);
            
            // ëª¨ë‘ì‹¤íŒ¨ ë²„íŠ¼
            buttons.push(`
                <button class="player-btn ${winners[currentHole] === 'allfail' ? 'allfail' : ''}"
                        onclick="selectWinner('allfail')" 
                        style="grid-column: span 1;">
                    ${winners[currentHole] === 'allfail' ? 'âŒ ' : ''}ëª¨ë‘ì‹¤íŒ¨
                </button>
            `);
            
            grid.innerHTML = buttons.join('');
            
            // í™€ ì¸ë””ì¼€ì´í„°
            const indicator = document.getElementById('holeIndicator');
            indicator.innerHTML = Array.from({ length: 9 }, (_, i) => i + 1)
                .map(hole => {
                    let className = 'hole-dot ';
                    if (hole === currentHole) className += 'current';
                    else if (winners[hole]) className += 'completed';
                    else className += 'pending';
                    return `<div class="${className}">${hole}</div>`;
                }).join('');
            
            // ë²„íŠ¼ ìƒíƒœ
            document.getElementById('prevBtn').disabled = currentHole === 1;
            const nextBtn = document.getElementById('nextBtn');
            if (currentHole === 9) {
                nextBtn.textContent = 'ë‹¤ìŒ ê²Œì„';
                nextBtn.onclick = finishCurrentGame;
            } else {
                nextBtn.textContent = 'ë‹¤ìŒ í™€ â†’';
                nextBtn.onclick = nextHole;
            }
        }

        // ìš°ìŠ¹ì ì„ íƒ
        function selectWinner(playerId) {
            winners[currentHole] = playerId;
            renderGamePlaying();
        }

        // ë‹¤ìŒ í™€
        function nextHole() {
            if (!winners[currentHole]) {
                alert('ì´ í™€ì˜ 1ë“±ì„ ì„ íƒí•´ì£¼ì„¸ìš”.');
                return;
            }
            if (currentHole < 9) {
                currentHole++;
                renderGamePlaying();
            }
        }

        // ì´ì „ í™€
        function prevHole() {
            if (currentHole > 1) {
                currentHole--;
                renderGamePlaying();
            }
        }

        // ê²°ê³¼ ë³´ê¸°
        function showResult() {
            if (!winners[currentHole]) {
                alert('ì´ í™€ì˜ 1ë“±ì„ ì„ íƒí•´ì£¼ì„¸ìš”.');
                return;
            }
            
            document.getElementById('gamePlaying').classList.add('hidden');
            document.getElementById('gameResult').classList.remove('hidden');
            renderResult();
        }

        // í˜„ì¬ ì§„í–‰ ì¤‘ì¸ ê²Œì„ì˜ ì¤‘ê°„ ê²°ê³¼ ë³´ê¸°
        function showCurrentResult() {
            document.getElementById('gamePlaying').classList.add('hidden');
            document.getElementById('gameResult').classList.remove('hidden');
            renderResult();
        }

        // í˜„ì¬ ê²Œì„ ì¢…ë£Œ ë° ì €ì¥
        function finishCurrentGame() {
            if (!winners[currentHole]) {
                alert('ì´ í™€ì˜ 1ë“±ì„ ì„ íƒí•´ì£¼ì„¸ìš”.');
                return;
            }
            
            // ê²Œì„ ìë™ ì €ì¥
            const activePlayers = players.filter(p => p.isActive);
            const game = {
                id: Date.now().toString(),
                date: new Date().toISOString(),
                course: currentCourse,
                holes: 9,
                penalty,
                participants: activePlayers.map(p => ({ id: p.id, name: p.name })),
                winners
            };
            
            const games = JSON.parse(localStorage.getItem(STORAGE_KEYS.GAMES) || '[]');
            games.push(game);
            localStorage.setItem(STORAGE_KEYS.GAMES, JSON.stringify(games));
            
            alert('âœ… ê²Œì„ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!\në‹¤ìŒ ê²Œì„ì„ ì‹œì‘í•˜ì„¸ìš”.');
            
            // ê²Œì„ ì„¤ì • í™”ë©´ìœ¼ë¡œ ëŒì•„ê°€ê¸°
            document.getElementById('gamePlaying').classList.add('hidden');
            document.getElementById('gameSetup').classList.remove('hidden');
            renderGameSetup();
        }

        // ê²°ê³¼ ë Œë”ë§
        function renderResult() {
            const activePlayers = players.filter(p => p.isActive);
            
            // ë¬´ìŠ¹ë¶€ì™€ ëª¨ë‘ì‹¤íŒ¨ íšŸìˆ˜ ê³„ì‚°
            const drawCount = Object.values(winners).filter(w => w === 'draw').length;
            const allFailCount = Object.values(winners).filter(w => w === 'allfail').length;
            
            const stats = activePlayers.map(player => {
                const wins = Object.values(winners).filter(id => id === player.id).length;
                
                // ë²Œê¸ˆíšŸìˆ˜ = ì „ì²´ í™€ìˆ˜ - 1ë“±í™€ìˆ˜ - ë¬´ìŠ¹ë¶€í™€ìˆ˜
                const penalties = 9 - wins - drawCount;
                
                // ë²Œê¸ˆê¸ˆì•¡ = (ë²Œê¸ˆíšŸìˆ˜ + ëª¨ë‘ì‹¤íŒ¨) * ë²Œê¸ˆ
                const amount = (penalties + allFailCount) * penalty;
                
                return {
                    id: player.id,
                    name: player.name,
                    wins,
                    drawCount,
                    allFailCount,
                    penalties,
                    amount
                };
            });
            
            const resultDiv = document.getElementById('resultStats');
            resultDiv.innerHTML = stats.map(stat => `
                <div class="stats-card">
                    <div style="font-weight: bold; font-size: 1.125rem; color: #047857; margin-bottom: 0.5rem;">
                        ${stat.name}
                    </div>
                    <div class="stats-grid">
                        <div class="stat-item" style="background: #fef3c7;">
                            <div class="stat-label" style="color: #78350f;">1ë“±</div>
                            <div class="stat-value" style="color: #92400e;">${stat.wins}íšŒ</div>
                        </div>
                        <div class="stat-item" style="background: #fee2e2;">
                            <div class="stat-label" style="color: #7f1d1d;">ë²Œê¸ˆ</div>
                            <div class="stat-value" style="color: #991b1b;">${stat.penalties}íšŒ</div>
                        </div>
                        <div class="stat-item" style="background: #d1fae5;">
                            <div class="stat-label" style="color: #065f46;">ê¸ˆì•¡</div>
                            <div class="stat-value" style="color: #047857;">${stat.amount.toLocaleString()}ì›</div>
                        </div>
                    </div>
                    ${stat.drawCount > 0 || stat.allFailCount > 0 ? `
                        <div style="font-size: 0.75rem; margin-top: 0.5rem; text-align: center; display: flex; gap: 0.5rem; justify-content: center;">
                            ${stat.drawCount > 0 ? `<span style="color: #3b82f6;">ğŸ¤ ë¬´ìŠ¹ë¶€: ${stat.drawCount}íšŒ</span>` : ''}
                            ${stat.allFailCount > 0 ? `<span style="color: #ef4444;">âŒ ëª¨ë‘ì‹¤íŒ¨: ${stat.allFailCount}íšŒ (+${stat.allFailCount * penalty}ì›)</span>` : ''}
                        </div>
                    ` : ''}
                </div>
            `).join('');
        }

        // ê²Œì„ìœ¼ë¡œ ëŒì•„ê°€ê¸°
        function backToGame() {
            document.getElementById('gameResult').classList.add('hidden');
            document.getElementById('gamePlaying').classList.remove('hidden');
        }

        // ê²Œì„ ì €ì¥
        function saveGame() {
            const activePlayers = players.filter(p => p.isActive);
            const game = {
                id: Date.now().toString(),
                date: new Date().toISOString(),
                course: currentCourse,
                holes: 9,
                penalty,
                participants: activePlayers.map(p => ({ id: p.id, name: p.name })),
                winners
            };
            
            const games = JSON.parse(localStorage.getItem(STORAGE_KEYS.GAMES) || '[]');
            games.push(game);
            localStorage.setItem(STORAGE_KEYS.GAMES, JSON.stringify(games));
            
            const date = new Date();
            const dateStr = `${date.getFullYear()}.${date.getMonth() + 1}.${date.getDate()}.`;
            alert(`âœ… ê²Œì„ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!\në‚ ì§œ: ${dateStr}\nì°¸ê°€ì: ${activePlayers.length}ëª…`);
            showPage('main');
        }

        // ìƒˆ ê²Œì„
        function newGame() {
            showPage('game');
        }

        // ê¸°ë¡ ë Œë”ë§ (ë‚ ì§œë³„ í•©ì‚°)
        function renderRecords() {
            const games = JSON.parse(localStorage.getItem(STORAGE_KEYS.GAMES) || '[]');
            
            const recordsDiv = document.getElementById('recordsList');
            
            if (games.length === 0) {
                recordsDiv.innerHTML = `
                    <div style="text-align: center; padding: 3rem 0;">
                        <p style="color: #6b7280; font-size: 1.125rem;">ì €ì¥ëœ ê²Œì„ ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤.</p>
                        <p style="color: #9ca3af; font-size: 0.875rem; margin-top: 0.5rem;">ê²Œì„ì„ í”Œë ˆì´í•˜ê³  ì €ì¥í•´ë³´ì„¸ìš”!</p>
                    </div>
                `;
                return;
            }
            
            // ë‚ ì§œë³„ë¡œ ê²Œì„ ê·¸ë£¹í™”
            const gamesByDate = {};
            games.forEach(game => {
                const date = new Date(game.date);
                const dateKey = `${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, '0')}-${String(date.getDate()).padStart(2, '0')}`;
                if (!gamesByDate[dateKey]) {
                    gamesByDate[dateKey] = [];
                }
                gamesByDate[dateKey].push(game);
            });
            
            // ë‚ ì§œë³„ë¡œ ì •ë ¬ (ìµœì‹ ìˆœ)
            const sortedDates = Object.keys(gamesByDate).sort((a, b) => b.localeCompare(a));
            
            recordsDiv.innerHTML = sortedDates.map(dateKey => {
                const dailyGames = gamesByDate[dateKey];
                const [year, month, day] = dateKey.split('-');
                const dateStr = `${year}.${parseInt(month)}.${parseInt(day)}.`;
                
                // ë‚ ì§œì˜ ëª¨ë“  ê²Œì„ì— ì°¸ê°€í•œ í”Œë ˆì´ì–´ ì°¾ê¸°
                const allParticipants = {};
                dailyGames.forEach(game => {
                    game.participants.forEach(p => {
                        if (!allParticipants[p.id]) {
                            allParticipants[p.id] = {
                                id: p.id,
                                name: p.name,
                                wins: 0,
                                penalties: 0,
                                amount: 0
                            };
                        }
                    });
                });
                
                // ê° ê²Œì„ì˜ í†µê³„ë¥¼ í•©ì‚°
                dailyGames.forEach(game => {
                    // ê²Œì„ë³„ ë¬´ìŠ¹ë¶€ì™€ ëª¨ë‘ì‹¤íŒ¨ íšŸìˆ˜
                    const drawCount = Object.values(game.winners).filter(w => w === 'draw').length;
                    const allFailCount = Object.values(game.winners).filter(w => w === 'allfail').length;
                    
                    game.participants.forEach(p => {
                        const wins = Object.values(game.winners).filter(id => id === p.id).length;
                        
                        // ë²Œê¸ˆíšŸìˆ˜ = ì „ì²´ í™€ìˆ˜ - 1ë“±í™€ìˆ˜ - ë¬´ìŠ¹ë¶€í™€ìˆ˜
                        const penalties = game.holes - wins - drawCount;
                        
                        // ë²Œê¸ˆê¸ˆì•¡ = (ë²Œê¸ˆíšŸìˆ˜ + ëª¨ë‘ì‹¤íŒ¨) * ë²Œê¸ˆ
                        const amount = (penalties + allFailCount) * game.penalty;
                        
                        if (allParticipants[p.id]) {
                            allParticipants[p.id].wins += wins;
                            allParticipants[p.id].penalties += penalties;
                            allParticipants[p.id].amount += amount;
                        }
                    });
                });
                
                const stats = Object.values(allParticipants);
                const totalGames = dailyGames.length;
                const totalHoles = dailyGames.reduce((sum, game) => sum + game.holes, 0);
                const participantCount = stats.length;
                
                // í•´ë‹¹ ë‚ ì§œì˜ ëª¨ë“  ê²Œì„ ID ë°°ì—´
                const gameIds = dailyGames.map(g => g.id).join(',');
                
                return `
                    <div class="record-card">
                        <div class="record-header">
                            <div>
                                <div style="font-size: 1.125rem; font-weight: bold;">[${dateStr}]</div>
                                <div style="font-size: 0.875rem; opacity: 0.9; margin-top: 0.25rem;">
                                    ì´ ê²Œì„: ${totalGames}íšŒ | ì´ í™€: ${totalHoles}í™€ | ì°¸ê°€: ${participantCount}ëª…
                                </div>
                            </div>
                            <button class="btn-danger" onclick="deleteDailyGames('${gameIds}', '${dateStr}')">ğŸ—‘ï¸ ì‚­ì œ</button>
                        </div>
                        <div class="record-body">
                            ${stats.map(stat => `
                                <div class="record-player">
                                    <div style="font-weight: 600; margin-bottom: 0.5rem;">${stat.name}</div>
                                    <div style="display: flex; gap: 1rem; font-size: 0.875rem;">
                                        <span style="color: #78350f;">ğŸ† 1ë“±: <strong>${stat.wins}íšŒ</strong></span>
                                        <span style="color: #991b1b;">ğŸ’¸ ë²Œê¸ˆ: <strong>${stat.penalties}íšŒ</strong></span>
                                        <span style="color: #047857;">ğŸ’° ê¸ˆì•¡: <strong>${stat.amount.toLocaleString()}ì›</strong></span>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                `;
            }).join('');
        }

        // ë‚ ì§œë³„ ê²Œì„ ì¼ê´„ ì‚­ì œ
        function deleteDailyGames(gameIdsStr, dateStr) {
            if (!confirm(`[${dateStr}]ì˜ ëª¨ë“  ê²Œì„ ê¸°ë¡ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) return;
            
            const gameIds = gameIdsStr.split(',');
            let games = JSON.parse(localStorage.getItem(STORAGE_KEYS.GAMES) || '[]');
            games = games.filter(g => !gameIds.includes(g.id));
            localStorage.setItem(STORAGE_KEYS.GAMES, JSON.stringify(games));
            renderRecords();
        }

        // ì•± ì¢…ë£Œ
        function exitApp() {
            if (confirm('ì•±ì„ ì¢…ë£Œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                window.close();
            }
        }

        // ë°ì´í„° ë‚´ë³´ë‚´ê¸°
        function exportData() {
            const data = {
                players: localStorage.getItem(STORAGE_KEYS.PLAYERS),
                games: localStorage.getItem(STORAGE_KEYS.GAMES),
                penalty: localStorage.getItem(STORAGE_KEYS.PENALTY),
                exportDate: new Date().toISOString()
            };
            
            const dataStr = JSON.stringify(data, null, 2);
            const dataBlob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(dataBlob);
            const link = document.createElement('a');
            link.href = url;
            link.download = `parkgolf_backup_${new Date().toISOString().split('T')[0]}.json`;
            link.click();
            URL.revokeObjectURL(url);
            
            alert('ë°ì´í„°ê°€ ë‚´ë³´ë‚´ê¸°ë˜ì—ˆìŠµë‹ˆë‹¤!');
        }

        // ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
        function importData() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.json';
            input.onchange = (e) => {
                const file = e.target.files[0];
                if (!file) return;
                
                const reader = new FileReader();
                reader.onload = (event) => {
                    try {
                        const data = JSON.parse(event.target.result);
                        
                        if (!confirm('ê¸°ì¡´ ë°ì´í„°ë¥¼ ë®ì–´ì“°ì‹œê² ìŠµë‹ˆê¹Œ? ì´ ì‘ì—…ì€ ë˜ëŒë¦´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.')) {
                            return;
                        }
                        
                        if (data.players) localStorage.setItem(STORAGE_KEYS.PLAYERS, data.players);
                        if (data.games) localStorage.setItem(STORAGE_KEYS.GAMES, data.games);
                        if (data.penalty) localStorage.setItem(STORAGE_KEYS.PENALTY, data.penalty);
                        
                        alert('ë°ì´í„°ë¥¼ ì„±ê³µì ìœ¼ë¡œ ê°€ì ¸ì™”ìŠµë‹ˆë‹¤!');
                        location.reload();
                    } catch (error) {
                        alert('ë°ì´í„° ê°€ì ¸ì˜¤ê¸°ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ì˜¬ë°”ë¥¸ ë°±ì—… íŒŒì¼ì¸ì§€ í™•ì¸í•´ì£¼ì„¸ìš”.');
                    }
                };
                reader.readAsText(file);
            };
            input.click();
        }

        // ì•± ì´ˆê¸°í™”
        init();
    </script>
</body>
</html>
